[tool.cibuildwheel]
archs = ["auto64"]
before-all = """
    git clone https://github.com/Restream/reindexer.git
    cd reindexer
    ./dependencies.sh
    brew reinstall --build-from-source leveldb libomp snappy
    mkdir -p build && cd build
    cmake ..
    make -j4
    sudo make install
    cd ../..
    sudo rm -rf reindexer/
"""

[tool.cibuildwheel.linux]
environment = { CIBUILDWHEEL = "1" }
manylinux-x86_64-image = "manylinux2014"
skip = ["*musllinux*"]

[tool.cibuildwheel.macos]
environment = { CIBUILDWHEEL = "1", LDFLAGS = "-Wl,-S" }

[build-system]
requires = [
    "setuptools",
    "wheel",
    "pybind11",
    "build"
]
build-backend = "setuptools.build_meta"